/**********************************************************
 *            AUTOGENERATED FILE                          *
 *             DO NOT MODIFY IT                           *
 *                                                        *
 * To add new commands :                                  *
 *  - Modify ../Xml/commands.xml file                     *
 *  - Re-run generateDeviceControllers.py script          *
 *                                                        *
 **********************************************************/

/**
* @file ARDeviceController.java
* @brief Device controller allow to drive a device.
*/

package com.parrot.arsdk.arcontroller;

import com.parrot.arsdk.ardiscovery.ARDISCOVERY_PRODUCT_ENUM;
import com.parrot.arsdk.arsal.ARSALPrint;
import com.parrot.arsdk.arcommands.*;
import com.parrot.arsdk.ardiscovery.ARDiscoveryDevice;

import com.parrot.arsdk.arsal.ARNativeData;

import java.util.List;
import java.util.ArrayList;

public class ARDeviceController
{
    private static String TAG = "ARDeviceController";

    private static native void nativeStaticInit ();

    private native long nativeNew(long jdevice) throws ARControllerException;
    private native void nativeDelete(long jARDeviceController);

    private native int nativeStart (long jDeviceController);
    private native int nativeStop (long jDeviceController);

    private native long nativeGetFeatureGeneric (long jDeviceController);
    private native long nativeGetFeatureAnimation (long jDeviceController);
    private native long nativeGetFeatureARDrone3 (long jDeviceController);
    private native long nativeGetFeatureCommon (long jDeviceController);
    private native long nativeGetFeatureControllerInfo (long jDeviceController);
    private native long nativeGetFeatureDebug (long jDeviceController);
    private native long nativeGetFeatureDroneManager (long jDeviceController);
    private native long nativeGetFeatureFollowMe (long jDeviceController);
    private native long nativeGetFeatureJumpingSumo (long jDeviceController);
    private native long nativeGetFeatureMapper (long jDeviceController);
    private native long nativeGetFeatureMapperMini (long jDeviceController);
    private native long nativeGetFeatureMiniDrone (long jDeviceController);
    private native long nativeGetFeaturePowerup (long jDeviceController);
    private native long nativeGetFeatureRc (long jDeviceController);
    private native long nativeGetFeatureSequoiaCam (long jDeviceController);
    private native long nativeGetFeatureSkyController (long jDeviceController);
    private native long nativeGetFeatureThermalCam (long jDeviceController);
    private native long nativeGetFeatureWifi (long jDeviceController);
    private native int nativeGetState (long jDeviceController) throws ARControllerException;
    private native int nativeGetExtensionState (long jDeviceController);
    private native String nativeGetExtensionName (long jDeviceController);
    private native int nativeGetExtensionProduct (long jDeviceController);
    private native long nativeGetCommandElements(long jDeviceController, int commandKey) throws ARControllerException;
    private native int nativeSendStreamFrame (long jDeviceController, long data, int dataSize);
    private native int nativeHasOutputVideoStream (long deviceController) throws ARControllerException;
    private native int nativeHasOutputAudioStream (long deviceController) throws ARControllerException;
    private native int nativeHasInputAudioStream (long deviceController) throws ARControllerException;
    private native int nativeStartVideoStream (long deviceController);
    private native int nativeStopVideoStream (long deviceController);

    private long jniDeviceController;
    private boolean initOk;

    private List<ARDeviceControllerListener> listeners;
    private List<ARDeviceControllerStreamListener> streamlisteners;
    private List<ARDeviceControllerStreamListener> audioStreamlisteners;
    ARFeatureGeneric featureGeneric;
    ARFeatureAnimation featureAnimation;
    ARFeatureARDrone3 featureARDrone3;
    ARFeatureCommon featureCommon;
    ARFeatureControllerInfo featureControllerInfo;
    ARFeatureDebug featureDebug;
    ARFeatureDroneManager featureDroneManager;
    ARFeatureFollowMe featureFollowMe;
    ARFeatureJumpingSumo featureJumpingSumo;
    ARFeatureMapper featureMapper;
    ARFeatureMapperMini featureMapperMini;
    ARFeatureMiniDrone featureMiniDrone;
    ARFeaturePowerup featurePowerup;
    ARFeatureRc featureRc;
    ARFeatureSequoiaCam featureSequoiaCam;
    ARFeatureSkyController featureSkyController;
    ARFeatureThermalCam featureThermalCam;
    ARFeatureWifi featureWifi;

    static
    {
        nativeStaticInit();
    }

    /**
     * Constructor
     */
    public ARDeviceController (ARDiscoveryDevice device) throws ARControllerException
    {
        initOk = false;
        ARCONTROLLER_ERROR_ENUM error = ARCONTROLLER_ERROR_ENUM.ARCONTROLLER_OK;

        if (device != null)
        {
            jniDeviceController = nativeNew(device.getNativeDevice());
        }
        else
        {
            error = ARCONTROLLER_ERROR_ENUM.ARCONTROLLER_ERROR_BAD_PARAMETER;
        }

        if (jniDeviceController != 0)
        {
            listeners = new ArrayList<ARDeviceControllerListener>();
            streamlisteners = new ArrayList<ARDeviceControllerStreamListener>();
            audioStreamlisteners = new ArrayList<ARDeviceControllerStreamListener>();
            initOk = true;

            reloadFeatures();
        }

        if (error != ARCONTROLLER_ERROR_ENUM.ARCONTROLLER_OK)
        {
            throw new ARControllerException (error);
        }
    }

    /**
     * Dispose
     */
    public void dispose()
    {
        ARCONTROLLER_ERROR_ENUM error = ARCONTROLLER_ERROR_ENUM.ARCONTROLLER_OK;
        synchronized (this)
        {
            if(initOk == true)
            {
                nativeDelete(jniDeviceController);
                jniDeviceController = 0;
                initOk = false;

                if (featureGeneric != null)
                {
                    featureGeneric.dispose();
                    featureGeneric = null;
                }

                if (featureAnimation != null)
                {
                    featureAnimation.dispose();
                    featureAnimation = null;
                }

                if (featureARDrone3 != null)
                {
                    featureARDrone3.dispose();
                    featureARDrone3 = null;
                }

                if (featureCommon != null)
                {
                    featureCommon.dispose();
                    featureCommon = null;
                }

                if (featureControllerInfo != null)
                {
                    featureControllerInfo.dispose();
                    featureControllerInfo = null;
                }

                if (featureDebug != null)
                {
                    featureDebug.dispose();
                    featureDebug = null;
                }

                if (featureDroneManager != null)
                {
                    featureDroneManager.dispose();
                    featureDroneManager = null;
                }

                if (featureFollowMe != null)
                {
                    featureFollowMe.dispose();
                    featureFollowMe = null;
                }

                if (featureJumpingSumo != null)
                {
                    featureJumpingSumo.dispose();
                    featureJumpingSumo = null;
                }

                if (featureMapper != null)
                {
                    featureMapper.dispose();
                    featureMapper = null;
                }

                if (featureMapperMini != null)
                {
                    featureMapperMini.dispose();
                    featureMapperMini = null;
                }

                if (featureMiniDrone != null)
                {
                    featureMiniDrone.dispose();
                    featureMiniDrone = null;
                }

                if (featurePowerup != null)
                {
                    featurePowerup.dispose();
                    featurePowerup = null;
                }

                if (featureRc != null)
                {
                    featureRc.dispose();
                    featureRc = null;
                }

                if (featureSequoiaCam != null)
                {
                    featureSequoiaCam.dispose();
                    featureSequoiaCam = null;
                }

                if (featureSkyController != null)
                {
                    featureSkyController.dispose();
                    featureSkyController = null;
                }

                if (featureThermalCam != null)
                {
                    featureThermalCam.dispose();
                    featureThermalCam = null;
                }

                if (featureWifi != null)
                {
                    featureWifi.dispose();
                    featureWifi = null;
                }

            }
            else
            {
                error = ARCONTROLLER_ERROR_ENUM.ARCONTROLLER_ERROR_JNI_INIT;
            }
        }
    }

    /**
     * Destructor
     */
    public void finalize () throws Throwable
    {
        try
        {
            dispose ();
        }
        finally
        {
            super.finalize ();
        }
    }

    public ARCONTROLLER_ERROR_ENUM start ()
    {
        ARCONTROLLER_ERROR_ENUM error = ARCONTROLLER_ERROR_ENUM.ARCONTROLLER_OK;
        synchronized (this)
        {
            if(initOk == true)
            {
                int nativeError = nativeStart(jniDeviceController);
                error = ARCONTROLLER_ERROR_ENUM.getFromValue(nativeError);
            }
            else
            {
                error = ARCONTROLLER_ERROR_ENUM.ARCONTROLLER_ERROR_JNI_INIT;
            }
        }

        return error;
    }

    public ARCONTROLLER_ERROR_ENUM stop ()
    {
        ARCONTROLLER_ERROR_ENUM error = ARCONTROLLER_ERROR_ENUM.ARCONTROLLER_OK;
        synchronized (this)
        {
            if(initOk == true)
            {
                int nativeError = nativeStop(jniDeviceController);
                error = ARCONTROLLER_ERROR_ENUM.getFromValue(nativeError);
            }
            else
            {
                error = ARCONTROLLER_ERROR_ENUM.ARCONTROLLER_ERROR_JNI_INIT;
            }
        }

        return error;
    }

    public ARFeatureGeneric getFeatureGeneric ()
    {
        return featureGeneric;
    }

    public ARFeatureAnimation getFeatureAnimation ()
    {
        return featureAnimation;
    }

    public ARFeatureARDrone3 getFeatureARDrone3 ()
    {
        return featureARDrone3;
    }

    public ARFeatureCommon getFeatureCommon ()
    {
        return featureCommon;
    }

    public ARFeatureControllerInfo getFeatureControllerInfo ()
    {
        return featureControllerInfo;
    }

    public ARFeatureDebug getFeatureDebug ()
    {
        return featureDebug;
    }

    public ARFeatureDroneManager getFeatureDroneManager ()
    {
        return featureDroneManager;
    }

    public ARFeatureFollowMe getFeatureFollowMe ()
    {
        return featureFollowMe;
    }

    public ARFeatureJumpingSumo getFeatureJumpingSumo ()
    {
        return featureJumpingSumo;
    }

    public ARFeatureMapper getFeatureMapper ()
    {
        return featureMapper;
    }

    public ARFeatureMapperMini getFeatureMapperMini ()
    {
        return featureMapperMini;
    }

    public ARFeatureMiniDrone getFeatureMiniDrone ()
    {
        return featureMiniDrone;
    }

    public ARFeaturePowerup getFeaturePowerup ()
    {
        return featurePowerup;
    }

    public ARFeatureRc getFeatureRc ()
    {
        return featureRc;
    }

    public ARFeatureSequoiaCam getFeatureSequoiaCam ()
    {
        return featureSequoiaCam;
    }

    public ARFeatureSkyController getFeatureSkyController ()
    {
        return featureSkyController;
    }

    public ARFeatureThermalCam getFeatureThermalCam ()
    {
        return featureThermalCam;
    }

    public ARFeatureWifi getFeatureWifi ()
    {
        return featureWifi;
    }

    public ARControllerDictionary getCommandElements (ARCONTROLLER_DICTIONARY_KEY_ENUM commandKey) throws ARControllerException
    {
        ARControllerDictionary elementDictionary = null;

        synchronized (this)
        {
            if(initOk == true)
            {
                if(commandKey != null)
                {
                    long nativeElementDictionary = nativeGetCommandElements(jniDeviceController, commandKey.getValue());

                    elementDictionary = new ARControllerDictionary(nativeElementDictionary);
                }
            }
        }

        return elementDictionary;
    }

    public ARCONTROLLER_ERROR_ENUM sendStreamingFrame (ARNativeData data)
    {
        ARCONTROLLER_ERROR_ENUM error = ARCONTROLLER_ERROR_ENUM.ARCONTROLLER_OK;

        synchronized (this)
        {
            if(initOk == true)
            {
                int nativeError = nativeSendStreamFrame(jniDeviceController, data.getData(), data.getDataSize());
                error = ARCONTROLLER_ERROR_ENUM.getFromValue(nativeError);
            }
        }

        return error;
    }

    public ARCONTROLLER_DEVICE_STATE_ENUM getState () throws ARControllerException
    {
        ARCONTROLLER_DEVICE_STATE_ENUM state = ARCONTROLLER_DEVICE_STATE_ENUM.ARCONTROLLER_DEVICE_STATE_MAX;
        synchronized (this)
        {
            if(initOk == true)
            {
                int nativeState = nativeGetState(jniDeviceController);
                state = ARCONTROLLER_DEVICE_STATE_ENUM.getFromValue(nativeState);
            }
            else
            {
                throw new ARControllerException(ARCONTROLLER_ERROR_ENUM.ARCONTROLLER_ERROR_JNI_INIT);
            }
        }

        return state;
    }

    public ARCONTROLLER_DEVICE_STATE_ENUM getExtensionState ()
    {
        ARCONTROLLER_DEVICE_STATE_ENUM extensionState = ARCONTROLLER_DEVICE_STATE_ENUM.ARCONTROLLER_DEVICE_STATE_MAX;
        synchronized (this)
        {
            if(initOk == true)
            {
                int nativeExtensionState = nativeGetExtensionState(jniDeviceController);
                extensionState = ARCONTROLLER_DEVICE_STATE_ENUM.getFromValue(nativeExtensionState);
            }
        }

        return extensionState;
    }

    public boolean hasOutputVideoStream () throws ARControllerException
    {
        boolean res = false;
        synchronized (this)
        {
            if(initOk == true)
            {
                int nativeRes = nativeHasOutputVideoStream(jniDeviceController);
                res = (nativeRes != 0);
            }
            else
            {
                throw new ARControllerException(ARCONTROLLER_ERROR_ENUM.ARCONTROLLER_ERROR_JNI_INIT);
            }
        }

        return res;
    }

    public boolean hasOutputAudioStream () throws ARControllerException
    {
        boolean res = false;
        synchronized (this)
        {
            if(initOk == true)
            {
                int nativeRes = nativeHasOutputAudioStream(jniDeviceController);
                res = (nativeRes != 0);
            }
            else
            {
                throw new ARControllerException(ARCONTROLLER_ERROR_ENUM.ARCONTROLLER_ERROR_JNI_INIT);
            }
        }

        return res;
    }

    public boolean hasInputAudioStream () throws ARControllerException
    {
        boolean res = false;
        synchronized (this)
        {
            if(initOk == true)
            {
                int nativeRes = nativeHasInputAudioStream(jniDeviceController);
                res = (nativeRes != 0);
            }
            else
            {
                throw new ARControllerException(ARCONTROLLER_ERROR_ENUM.ARCONTROLLER_ERROR_JNI_INIT);
            }
        }

        return res;
    }

    public ARCONTROLLER_ERROR_ENUM startVideoStream ()
    {
        ARCONTROLLER_ERROR_ENUM res;
        synchronized (this)
        {
            if (!initOk)
                return ARCONTROLLER_ERROR_ENUM.ARCONTROLLER_ERROR_JNI_INIT;
            int nativeRes = nativeStartVideoStream(jniDeviceController);
            res = ARCONTROLLER_ERROR_ENUM.getFromValue(nativeRes);
        }
        return res;
    }

    public ARCONTROLLER_ERROR_ENUM stopVideoStream () throws ARControllerException
    {
        ARCONTROLLER_ERROR_ENUM res;
        synchronized (this)
        {
            if (!initOk)
                return ARCONTROLLER_ERROR_ENUM.ARCONTROLLER_ERROR_JNI_INIT;
            int nativeRes = nativeStopVideoStream(jniDeviceController);
            res = ARCONTROLLER_ERROR_ENUM.getFromValue(nativeRes);
        }
        return res;
    }

    public String getExtensionName ()
    {
        String extensionName = null;
        synchronized (this)
        {
            if(initOk == true)
            {
                extensionName = nativeGetExtensionName(jniDeviceController);
            }
        }

        return extensionName;
    }

    public ARDISCOVERY_PRODUCT_ENUM getExtensionProduct ()
    {
        ARDISCOVERY_PRODUCT_ENUM extensionProduct = ARDISCOVERY_PRODUCT_ENUM.ARDISCOVERY_PRODUCT_MAX;
        synchronized (this)
        {
            if(initOk == true)
            {
                int nativeExtensionProduct = nativeGetExtensionProduct(jniDeviceController);
                extensionProduct = ARDISCOVERY_PRODUCT_ENUM.getFromValue(nativeExtensionProduct);
            }
        }

        return extensionProduct;
    }

    public synchronized void addListener (ARDeviceControllerListener listener)
    {
       if (! listeners.contains(listener))
       {
           listeners.add (listener);
       }
    }

    public synchronized void removeListener (ARDeviceControllerListener listener)
    {
        listeners.remove (listener);
    }

    public synchronized void addStreamListener (ARDeviceControllerStreamListener listener)
    {
       if (! streamlisteners.contains(listener))
       {
           streamlisteners.add (listener);
       }
    }

    public synchronized void removeStreamListener (ARDeviceControllerStreamListener listener)
    {
        streamlisteners.remove (listener);
    }

    public synchronized void addAudioStreamListener (ARDeviceControllerStreamListener listener)
    {
        if (! audioStreamlisteners.contains(listener))
        {
            audioStreamlisteners.add (listener);
        }
    }

    public synchronized void removeAudioStreamListener (ARDeviceControllerStreamListener listener)
    {
        audioStreamlisteners.remove (listener);
    }

    private void reloadFeatures()
    {
        long nativeFeatureGeneric = nativeGetFeatureGeneric (jniDeviceController);
        if (nativeFeatureGeneric != 0)
        {
            if (featureGeneric == null)
            {
                featureGeneric = new ARFeatureGeneric(nativeFeatureGeneric);
            }
        }
        else
        {
            featureGeneric = null;
        }

        long nativeFeatureAnimation = nativeGetFeatureAnimation (jniDeviceController);
        if (nativeFeatureAnimation != 0)
        {
            if (featureAnimation == null)
            {
                featureAnimation = new ARFeatureAnimation(nativeFeatureAnimation);
            }
        }
        else
        {
            featureAnimation = null;
        }

        long nativeFeatureARDrone3 = nativeGetFeatureARDrone3 (jniDeviceController);
        if (nativeFeatureARDrone3 != 0)
        {
            if (featureARDrone3 == null)
            {
                featureARDrone3 = new ARFeatureARDrone3(nativeFeatureARDrone3);
            }
        }
        else
        {
            featureARDrone3 = null;
        }

        long nativeFeatureCommon = nativeGetFeatureCommon (jniDeviceController);
        if (nativeFeatureCommon != 0)
        {
            if (featureCommon == null)
            {
                featureCommon = new ARFeatureCommon(nativeFeatureCommon);
            }
        }
        else
        {
            featureCommon = null;
        }

        long nativeFeatureControllerInfo = nativeGetFeatureControllerInfo (jniDeviceController);
        if (nativeFeatureControllerInfo != 0)
        {
            if (featureControllerInfo == null)
            {
                featureControllerInfo = new ARFeatureControllerInfo(nativeFeatureControllerInfo);
            }
        }
        else
        {
            featureControllerInfo = null;
        }

        long nativeFeatureDebug = nativeGetFeatureDebug (jniDeviceController);
        if (nativeFeatureDebug != 0)
        {
            if (featureDebug == null)
            {
                featureDebug = new ARFeatureDebug(nativeFeatureDebug);
            }
        }
        else
        {
            featureDebug = null;
        }

        long nativeFeatureDroneManager = nativeGetFeatureDroneManager (jniDeviceController);
        if (nativeFeatureDroneManager != 0)
        {
            if (featureDroneManager == null)
            {
                featureDroneManager = new ARFeatureDroneManager(nativeFeatureDroneManager);
            }
        }
        else
        {
            featureDroneManager = null;
        }

        long nativeFeatureFollowMe = nativeGetFeatureFollowMe (jniDeviceController);
        if (nativeFeatureFollowMe != 0)
        {
            if (featureFollowMe == null)
            {
                featureFollowMe = new ARFeatureFollowMe(nativeFeatureFollowMe);
            }
        }
        else
        {
            featureFollowMe = null;
        }

        long nativeFeatureJumpingSumo = nativeGetFeatureJumpingSumo (jniDeviceController);
        if (nativeFeatureJumpingSumo != 0)
        {
            if (featureJumpingSumo == null)
            {
                featureJumpingSumo = new ARFeatureJumpingSumo(nativeFeatureJumpingSumo);
            }
        }
        else
        {
            featureJumpingSumo = null;
        }

        long nativeFeatureMapper = nativeGetFeatureMapper (jniDeviceController);
        if (nativeFeatureMapper != 0)
        {
            if (featureMapper == null)
            {
                featureMapper = new ARFeatureMapper(nativeFeatureMapper);
            }
        }
        else
        {
            featureMapper = null;
        }

        long nativeFeatureMapperMini = nativeGetFeatureMapperMini (jniDeviceController);
        if (nativeFeatureMapperMini != 0)
        {
            if (featureMapperMini == null)
            {
                featureMapperMini = new ARFeatureMapperMini(nativeFeatureMapperMini);
            }
        }
        else
        {
            featureMapperMini = null;
        }

        long nativeFeatureMiniDrone = nativeGetFeatureMiniDrone (jniDeviceController);
        if (nativeFeatureMiniDrone != 0)
        {
            if (featureMiniDrone == null)
            {
                featureMiniDrone = new ARFeatureMiniDrone(nativeFeatureMiniDrone);
            }
        }
        else
        {
            featureMiniDrone = null;
        }

        long nativeFeaturePowerup = nativeGetFeaturePowerup (jniDeviceController);
        if (nativeFeaturePowerup != 0)
        {
            if (featurePowerup == null)
            {
                featurePowerup = new ARFeaturePowerup(nativeFeaturePowerup);
            }
        }
        else
        {
            featurePowerup = null;
        }

        long nativeFeatureRc = nativeGetFeatureRc (jniDeviceController);
        if (nativeFeatureRc != 0)
        {
            if (featureRc == null)
            {
                featureRc = new ARFeatureRc(nativeFeatureRc);
            }
        }
        else
        {
            featureRc = null;
        }

        long nativeFeatureSequoiaCam = nativeGetFeatureSequoiaCam (jniDeviceController);
        if (nativeFeatureSequoiaCam != 0)
        {
            if (featureSequoiaCam == null)
            {
                featureSequoiaCam = new ARFeatureSequoiaCam(nativeFeatureSequoiaCam);
            }
        }
        else
        {
            featureSequoiaCam = null;
        }

        long nativeFeatureSkyController = nativeGetFeatureSkyController (jniDeviceController);
        if (nativeFeatureSkyController != 0)
        {
            if (featureSkyController == null)
            {
                featureSkyController = new ARFeatureSkyController(nativeFeatureSkyController);
            }
        }
        else
        {
            featureSkyController = null;
        }

        long nativeFeatureThermalCam = nativeGetFeatureThermalCam (jniDeviceController);
        if (nativeFeatureThermalCam != 0)
        {
            if (featureThermalCam == null)
            {
                featureThermalCam = new ARFeatureThermalCam(nativeFeatureThermalCam);
            }
        }
        else
        {
            featureThermalCam = null;
        }

        long nativeFeatureWifi = nativeGetFeatureWifi (jniDeviceController);
        if (nativeFeatureWifi != 0)
        {
            if (featureWifi == null)
            {
                featureWifi = new ARFeatureWifi(nativeFeatureWifi);
            }
        }
        else
        {
            featureWifi = null;
        }

    }

    private void onStateChanged (int newState, int error)
    {
        for (ARDeviceControllerListener l : listeners)
        {
            l.onStateChanged (this, ARCONTROLLER_DEVICE_STATE_ENUM.getFromValue(newState), ARCONTROLLER_ERROR_ENUM.getFromValue(error));
        }
    }

    private void onExtensionStateChanged (int newState, int product, String name, int error)
    {
        // reload the features because they might have changed
        reloadFeatures();
        for (ARDeviceControllerListener l : listeners)
        {
            l.onExtensionStateChanged (this, ARCONTROLLER_DEVICE_STATE_ENUM.getFromValue(newState), ARDISCOVERY_PRODUCT_ENUM.getFromValue(product), name, ARCONTROLLER_ERROR_ENUM.getFromValue(error));
        }
    }

    private void onCommandReceived (int nativeCommandKey, long elementDictionary)
    {
        ARCONTROLLER_DICTIONARY_KEY_ENUM commandKey = ARCONTROLLER_DICTIONARY_KEY_ENUM.getFromValue(nativeCommandKey);

        ARControllerDictionary dictionary = new ARControllerDictionary(elementDictionary);

        for (ARDeviceControllerListener l : listeners)
        {
            l.onCommandReceived (this, ARCONTROLLER_DICTIONARY_KEY_ENUM.getFromValue(nativeCommandKey), dictionary);
        }
    }

    private int decoderConfigCallback (ARControllerCodec codec)
    {
        boolean failed = false;

        for (ARDeviceControllerStreamListener l : streamlisteners)
        {
            ARCONTROLLER_ERROR_ENUM error = l.configureDecoder(this, codec);

            if (error != ARCONTROLLER_ERROR_ENUM.ARCONTROLLER_OK)
            {
                failed = true;
            }
        }

        codec.dispose();

        return (failed) ? ARCONTROLLER_ERROR_ENUM.ARCONTROLLER_ERROR.getValue() : ARCONTROLLER_ERROR_ENUM.ARCONTROLLER_OK.getValue();
    }

    private int didReceiveFrameCallback (long data, int dataCapacity, int dataSize, int nativeIsIFrame, int missed, long timestamp, long metadata, int metadataSize)
    {
        boolean failed = false;
        boolean isIFrame = (nativeIsIFrame != 0);
        ARFrame frame = new ARFrame (data, dataCapacity, dataSize, isIFrame, missed, timestamp, metadata, metadataSize);

        for (ARDeviceControllerStreamListener l : streamlisteners)
        {
            ARCONTROLLER_ERROR_ENUM error = l.onFrameReceived (this, frame);

            if (error != ARCONTROLLER_ERROR_ENUM.ARCONTROLLER_OK)
            {
                failed = true;
            }
        }

        frame.dispose();

        return (failed) ? ARCONTROLLER_ERROR_ENUM.ARCONTROLLER_ERROR.getValue() : ARCONTROLLER_ERROR_ENUM.ARCONTROLLER_OK.getValue();
    }

    private void timeoutFrameCallback ()
    {
        for (ARDeviceControllerStreamListener l : streamlisteners)
        {
            l.onFrameTimeout (this);
        }
    }

    private int decoderAudioConfigCallback (ARControllerCodec codec)
    {
        boolean failed = false;

        for (ARDeviceControllerStreamListener l : audioStreamlisteners)
        {
            ARCONTROLLER_ERROR_ENUM error = l.configureDecoder(this, codec);

            if (error != ARCONTROLLER_ERROR_ENUM.ARCONTROLLER_OK)
            {
                failed = true;
            }
        }

        codec.dispose();

        return (failed) ? ARCONTROLLER_ERROR_ENUM.ARCONTROLLER_ERROR.getValue() : ARCONTROLLER_ERROR_ENUM.ARCONTROLLER_OK.getValue();
    }

    private int didReceiveAudioFrameCallback (long data, int dataCapacity, int dataSize, int nativeIsIFrame, int missed, long timestamp, long metadata, int metadataSize)
    {
        boolean failed = false;
        boolean isIFrame = (nativeIsIFrame != 0);
        ARFrame frame = new ARFrame (data, dataCapacity, dataSize, isIFrame, missed, timestamp, metadata, metadataSize);

        for (ARDeviceControllerStreamListener l : audioStreamlisteners)
        {
            ARCONTROLLER_ERROR_ENUM error = l.onFrameReceived (this, frame);

            if (error != ARCONTROLLER_ERROR_ENUM.ARCONTROLLER_OK)
            {
                failed = true;
            }
        }

        frame.dispose();

        return (failed) ? ARCONTROLLER_ERROR_ENUM.ARCONTROLLER_ERROR.getValue() : ARCONTROLLER_ERROR_ENUM.ARCONTROLLER_OK.getValue();
    }

    private void  timeoutAudioFrameCallback ()
    {
        for (ARDeviceControllerStreamListener l : audioStreamlisteners)
        {
            l.onFrameTimeout (this);
        }
    }
}

